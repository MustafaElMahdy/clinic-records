{% extends "base.html" %}
{% block title %}Manage Users - {{ request.clinic.name }}{% endblock %}
{% block content %}

<div class="row" style="align-items:center; justify-content:space-between; margin-bottom: 20px;">
  <div>
    <h1>Manage Users</h1>
    <div class="muted">{{ request.clinic.name }}</div>
  </div>
  <div style="display: flex; gap: 10px;">
    <a href="{% url 'patients:admin_dashboard' %}" class="btn">← Admin Dashboard</a>
    <a href="{% url 'accounts:create' %}" class="btn primary">Add User</a>
  </div>
</div>

<div class="card">
  {% if users %}
    <table class="table">
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      {% for u in users %}
        <tr>
          <td>
            <strong>{{ u.username }}</strong>
            {% if u == request.user %}<span class="badge" style="margin-left: 6px;">You</span>{% endif %}
          </td>
          <td class="muted">{{ u.email|default:"—" }}</td>
          <td><span class="badge">{{ u.get_role_display }}</span></td>
          <td>
            {% if u.is_active %}
              <span style="color: #059669; font-size: 13px;">Active</span>
            {% else %}
              <span class="muted" style="font-size: 13px;">Inactive</span>
            {% endif %}
          </td>
          <td>
            <div style="display: flex; gap: 8px;">
              <a href="{% url 'accounts:edit' u.pk %}" class="btn" style="padding: 6px 10px; font-size: 13px;">Edit</a>

              {% if u != request.user %}
                <form method="post" action="{% url 'accounts:toggle_active' u.pk %}" style="display:inline;">
                  {% csrf_token %}
                  {% if u.is_active %}
                    <button type="submit" class="btn danger" style="padding: 6px 10px; font-size: 13px;">Deactivate</button>
                  {% else %}
                    <button type="submit" class="btn" style="padding: 6px 10px; font-size: 13px; color: #059669; border-color: #059669;">Activate</button>
                  {% endif %}
                </form>
              {% endif %}
            </div>
          </td>
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p class="muted">No users found.</p>
  {% endif %}
</div>

{% endblock %}
